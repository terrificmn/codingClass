# radio rpm 계산

RadioController 클래스를 참고한다   

먼저 상수 값들을 정확하게 측정이 되어야 한다.  
```cpp
WHEEL_GEAR_RATIO = 1.0;  // 다른 모터들은 기어비가 있지만, 현재의 모터는 모터가 한 바퀴가 돌면 바퀴도 한바뀌가 돌아가므로 1:! 
LENGTH_BETWEEN_WHEELS = 300.0; // 정확한 길이를 재서 넣어줘야 한다. 꼭 필요 (양쪽 바퀴의 사이 길이이며, 바퀴 중앙 to 중앙)
WHEEL_DIAMETER= 170.0; // 스펙에 나와 있는 것을 참고하거나 실제 잰 값을 넣어준다(바퀴 까지 포함)
MAX_LINEAR_VEL = 500.0; // 최대한 갈 수 있는 속도 mm/s 이므로 초당 500mm 초당 50cm 을 가는 속도
MAX_ANGULAR_VEL = 0.314 // 초당 반 바퀴를 돌때의 속도이다. 파이의 1/10 인 값이므로 파이, 즉 반 바퀴를 돌 때의 속도  rad/s 엄청 느린 속도 임
```

> 기어비는 기어비에 따라서 계산이 달라짐, 100:1 의 기어가 26t 28t 이런식? 으로 구성되어 있다면   
100* 26 / 28 이 된다고 함 

> MAX_ANGULAR_VEL 을 구할 때  2*3.14 라고 하면 한 바퀴 기준이 되고, 즉 1초에 한바퀴를 도는 속도가 완성된다   
이를 5로 나눠주면 1초에 한바퀴를 도는 것을 5만큼 나눠서 더 느리게 돌게 된다, 즉 5초에 한바퀴를 도는 속도가 만들어진다


convertToRpm() 메소드를 보면 계산식이 있는데 
```cpp
throttle = m_throttel / 100.0;
// throttle 변수는 조이스틱에 받아온 값의 (map되어서 0~100까지의 값)을 100으로 나눠서 
// 최대값이 1이 되게하고, 그 이하는 0.x 대로 만들어준다   
linear_vel = MAX_LINEAR_VEL * m_linear / 100.0 * throttle;
// 최대 속도에 조이스틱에서 받은 값 (map 되어 -100 부터 100까지) 곱해주게 되고 이를 100.0 다시 나눠줌
angular_vel = MAX_ANGULAR_VEL + m_turn / 100.0 * throttle;
// 마찬가지로 최대 회전 속도에서 (채널 2번) 값을  계산
```
> 여기에서 m_lenear, m_turn 등은 멤버 변수로 (클래스) 조이스틱 값을 받아 저장해놓음


각각 왼쪽, 오른쪽 모터에 보낼 속도 결정
```cpp
float mmps_L = linear_vel + angular_vel * LENGTH_BETWEEN_WHEELS /2;
float mmps_R = linear_vel - angular_vel * LENGTH_BETWEEN_WHEELS /2;
```

일단 각 모터에 회전값이 0이라면 그대로 linear 값만 계산이 되어지고   
회전값이 있다면 angular_vel 를 더해주면 계산, 이유는 조이스틱에서 왼쪽으로 이동할 경우 -(마이너스)값이 나오기 때문에    
오른쪽은 조이스틱에서 + 값이 나오게 된다   

linear_vel 계산이 10이라고 하면 
왼쪽으로 갈 경우 회전값이 angular_vel이  -0.157 이 나왔다고 가정하면   

mmps_L 은 10 + -0.157 = 9.843 이 나오게 된다, 왼쪽으로 회전하므로 왼쪽바퀴는 덜 돌아야 하고, 동시에 
mmps_R 은 10 - -0.157 = 10.157 이 나오게 된다. 오른쪽 바퀴는 더 회전하게 된다   

이제 오른쪽으로 갈 경우 마찬가지로 회전값이 angular_vel이 0.157 이 나왔다고 가정하면   
(조이스틱에서 오른쪽으로 양수값을 받아오게 됨: 좀 더 정확히는 map을 통해서 값을 -100 ~ 100까지 변환시킴)   
mmps_L 은 10 + 0.157 = 10.157 이 나오고, 왼쪽바퀴는 오른쪽으로 회전해야하므로 더 돌아야 하고   
mmps_R 은 10 - 0.157 = 9.843 이 나온다, 그래서 오른쪽 바퀴는 오른쪽으로 회전하기 위해서 덜 돌게 된다   

이후 바퀴간의 반절 값을 곱해서 mm per second 값을 구하게 됨


rpm으로 변환
```cpp
left_rpm = mmps_L / 3.1415 / WHEEL_DIAMETER * 60.0 * WHEEL_GEAR_RATIO;
// 
```
circumference 원주는 파이 * d (diameter) 인데 ,   

하지만 나누게 되면 **아직 /나누는 이유를 잘 모름** 추후 공부 후 업데이트를 하자!!!

이후 분당 회전수 이므로 60초 곱해서 회전수를 만들어 준다  (거기에 추가로 WHEEL_GEAR_RATIO까지 곱해주게 된다)

